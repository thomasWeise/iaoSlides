%%%
%%% Load etoolbox for making slides have entries in bookmarks
%%%
\RequirePackage{etoolbox}%
%
%
%%%
%%% The definition for the title page.
%%%
\defbeamertemplate*{title page}{IAO}[1][]{%
\vbox{}%
\strut\vfill\strut%
\centering%
\vfill\vfill\vfill\vfill%
{\usebeamercolor[fg]{title}\usebeamerfont{title}\inserttitle}%
\begingroup{\ifx\insertsubtitle\empty%
\vfill%
\else\par%
\usebeamercolor[fg]{title}\usebeamerfont{title}\large{\insertsubtitle}%
\vfill%
\fi}\endgroup%
\begin{beamercolorbox}[center,#1]{author}%
\usebeamercolor[fg]{title}\usebeamerfont{author}\insertauthor%
\end{beamercolorbox}\vfill%
\begin{beamercolorbox}[center,#1]{institute}%
\usebeamercolor[fg]{title}\usebeamerfont{institute}\insertinstitute%
\end{beamercolorbox}\vfill%
%
%% insert date only if actually set
\ifx\relax\insertdate\relax%
\expandafter\@firstoftwo%
\else%
\expandafter\@secondoftwo%
\fi%
{}{%
\begin{beamercolorbox}[center,#1]{date}%
\usebeamercolor[fg]{title}\usebeamerfont{date}\insertdate%
\end{beamercolorbox}%
}%
\vfill\vfill\vfill\vfill\vfill%
}%
%
%
\global\let\insertdate\relax%
%
%
%
%%%
%%% Call \startPresentation at the beginning of the presentation to make
%%% the title and the outline slides as well as to set the proper background
%%% graphics
%%%
%
\gdef\startPresentation#1{%
%
\setbeamertemplate{footline}{}%
%
\usebackgroundtemplate{%
\hspace{-0.005\paperwidth}%
\vspace{-0.005\paperheight}%
\includegraphics[width=1.01\paperwidth,height=1.01\paperheight]{%
./graphics/iao/iao_slides_cover/iao_slides_cover}}%
%
\begin{frame}%
\titlepage%
\end{frame}%
%
%
\defbeamertemplate*{footline}{IOAO}{%
{\color{footlineForeground}%
\strut\hfill%
{\insertshorttitle}%
%%
%% insert date only if actually set
\ifx\relax\insertdate\relax%
\expandafter\@firstoftwo%
\else%
\expandafter\@secondoftwo%
\fi%
{}{, {\insertshortdate{}}%
%
}%
%
\hfill\hfill%
{\insertshortauthor}%
\hfill\hfill%
{{\insertframenumber{}}/{\inserttotalframenumber}}%
\hfill\strut
\vskip2pt%
}}%
%
%
\pgfdeclareimage[width=1.01\paperwidth,height=1.01\paperheight]{iao_slides_background}{%
./graphics/iao/iao_slides_background/iao_slides_background}%
\usebackgroundtemplate{%
\hspace{-0.005\paperwidth}%
\vspace{-0.005\paperheight}%
\pgfuseimage{iao_slides_background}}%
%
\begin{frame}%
\frametitle{Outline}%
\tableofcontents[subsectionstyle=hide/hide/hide]%
#1%
\end{frame}%
%
%
\if\relax\detokenize{\@authorRaw}\relax%
\expandafter\@firstoftwo%
\else%
\expandafter\@secondoftwo%
\fi%
{}{\author[\@authorPlain]{\@authorRaw}}%
%
\institute{%
%
\@blUni%
%
\if\relax\detokenize{\@blGroup}\relax%
\expandafter\@firstoftwo%
\else%
\expandafter\@secondoftwo%
\fi%
{%
\if\relax\detokenize{\@blFaculty}\relax%
\expandafter\@firstoftwo%
\else%
\expandafter\@secondoftwo%
\fi%
{}{\\\@blFaculty}%
}{\\\@blGroup}%
%
\if\relax\detokenize{\@blAddressA}\relax%
\expandafter\@firstoftwo%
\else%
\expandafter\@secondoftwo%
\fi%
{}{\\\@blAddressA}%
}%
}%
%

%%% The internal command for making an end-presentation slide
%%% #1 the name in the table of contents
%%% #2 the link
\gdef\@@@endSlide#1#2{%
\usebackgroundtemplate{%
\hspace{-0.005\paperwidth}%
\vspace{-0.005\paperheight}%
\includegraphics[width=1.01\paperwidth,height=1.01\paperheight]{%
./graphics/iao/iao_slides_final/iao_slides_final}}%
%
\begin{frame}%
\pdfbookmark[1]{#1}{#2}%
\strut\par\bigskip\par\strut%%
\parbox{0.434\paperwidth}{\flushright%
\scalebox{2}{\textbf{\LARGE{\textcolor{headlineForeground}{\zhb{谢谢}}}}}\bigskip\par%
\scalebox{1.2}{\textbf{\LARGE{\textcolor{headlineForeground}{Thank you}}}}\bigskip\par%
~%
\parbox{0.42\paperwidth}{\flushright%
\textcolor{headlineForeground}{\insertauthor}\bigskip\par%
\textcolor{headlineForeground}{\insertinstitute}%
}}%
\end{frame}%
}%
%
%%%
%%% Call \endPresentation to mark the official end of the presentation.
%%% It may or may not add a slide with references.
%%% After this, you may still add appendix slides.
%%%
%
\gdef\endPresentation{%
%
\global\let\@framePatch\@framePatch@doNothing%
%
\@@@endSlide{Presentation End}{presentationEnd}%
%
\ifnum\@bib@numcites>0\relax%
\expandafter\@firstoftwo%
\else%
\expandafter\@secondoftwo%
\fi{%
%
\usebackgroundtemplate{%
\hspace{-0.005\paperwidth}%
\vspace{-0.005\paperheight}%
\pgfuseimage{iao_slides_background}}%
%
%
\begin{frame}%%
\frametitle{\bibname}%
\pdfbookmark[1]{\bibname}{bibliographyZ}%
\begin{center}%
\strut\vfill\par%
\includegraphics[width=0.5\paperwidth]{./graphics/iao/iao_slides_bibliography/iao_slides_bibliography}%
\par\vfill\strut%
\end{center}%
\end{frame}%
%
\section*{\bibname}%
\def\newblock{\beamer@newblock}%
%
\begin{frame}[allowframebreaks,t]{\bibname}%
\begin{tiny}%
\bibliographystyle{unsrtnat}%
\bibliography{./bibliography/bibliography}%
\end{tiny}%
\end{frame}%
}{}%
%
\global\let\@framePatch\@framePatch@addBookmarks%
%
}%
%
% define appendix command; print #1 on appendix slide
\gdef\appendices#1{%
\usebackgroundtemplate{%
\hspace{-0.005\paperwidth}%
\vspace{-0.005\paperheight}%
\pgfuseimage{iao_slides_background}}%
\pdfbookmark[1]{Appendices}{appendices}%
\section*{Appendices}%
\begin{frame}%
\frametitle{Appendix Outline}%
\tableofcontents[sectionstyle=show/hide,subsectionstyle=show/show/hide]%
#1%
\end{frame}%
%
\global\newcount\@appendix@hrefids%
\global\@appendix@hrefids 0\relax%
%
\gdef\appendix##1{%
\global\advance \@appendix@hrefids 1\relax%
\expandafter\pdfbookmark\expandafter[\expandafter2\expandafter]\expandafter{##1}{appendix\the\@appendix@hrefids}%
\subsection{##1}%
}%
%
\AtEndDocument{\@@@endSlide{Real Presentation End}{realPresentationEnd}}%
}%
%
%
%
%
%%%
%%% Make each slide have an entry in the pdf bookmarks
%%%
\def\@framePatch@addBookmarks#1{\bookmark[page=\the\c@page,level=3]{#1}}%
\def\@framePatch@doNothing#1{}%
\let\@framePatch\@framePatch@addBookmarks%
\apptocmd{\beamer@@frametitle}{\only<1>{\@framePatch{#1}}}%
{\message{** patching of \string\beamer@@frametitle succeeded **}}%
{\message{** patching of \string\beamer@@frametitle failed **}}%
%
%
\gdef\printSectionOutlines{%
\AtBeginSection[]{%
\begin{frame}%
\frametitle{Section Outline}%
\tableofcontents[currentsection,subsectionstyle=show/show/hide]%
\end{frame}%
}%
}%
%
